<!-- Begin Page Content -->
<div class="container-fluid" id="admin-content">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray"><strong>Welcome,</strong> <span id="userEmail1"></h1>
        
      </div>
    
      <!-- Content Row -->
      <div class="row" id="dashboard-cards">
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">Total Wanted People</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800" id="wanted-a">
  
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-male fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Total Missing People</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800" id="missing-a">
  
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-people-carry fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
    
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total Reports</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800" id="report-a">
  
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-chart-bar fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
    
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-danger shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Total Newsletter Emails</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800" id="newsletter-a">
  
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-envelope fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
    
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Total News</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800" id="news-a">
  
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-newspaper fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row g-4 mb-2 text-center">
          <div class="container">
            <div>
              <canvas id="myChart"></canvas>
            </div>
          </div>
          
          <div class="col-sm-12" id="reports-progress">
            <div class="spinner-border" style="margin: auto; width: 100px; height: 100px;" role="status">
              <span class="visually-hidden">Loading...</span>
          </div>
        </div>
    </div>
        
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/js/bootstrap.bundle.min.js"></script>
    <link rel="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  
    <script src="js/admin-service.js"></script>
  <script src="js/news-service.js"></script>
  <script src="js/reports-service.js"></script>
  <script src="js/wanted-service.js"></script>
  <script src="js/missing-service.js"></script>
  <script src="js/newsletter-service.js"></script>
  <script src="js/jquery.validate.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
  

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
              <div class="copyright text-center my-auto">
                <span>Copyright &copy; Departamento de Investigacion Criminal 2023</span>
              </div>
            </div>
          </footer>
          <!-- End of Footer -->
          </div>
            <!-- /.container-fluid -->
    
          </div>
          <!-- End of Main Content -->
        </div>
        <!-- End of Content Wrapper -->
  
        <style>
          @media (max-width: 768px) {
            .container {
              width: 100%;
              height: 250px;
            }
          }
          canvas {
            width: 100% !important;
            height: auto !important;
          }
          @media (min-width: 992px) {
            .container {
                width: 70%;
              }
            }
          h2 {
            text-align: center;
            font-family: "Verdana", sans-serif;
            font-size: 30px;
          }
        </style>

  <script>
        // Get the token from the cookie or any other storage mechanism
      var tokenn = localStorage.getItem("token"); // Replace with your method to retrieve the token
      
      // Decode the token payload
      var decodedTokenn = jwt_decode(tokenn);
      
      // Access the information from the decoded payload
      var userId1 = decodedTokenn.id;
      var userEmail1 = decodedTokenn.email;
      // Access other properties as needed
      
      // Display the information in the HTML elements
      document.getElementById("userEmail1").textContent = userEmail1;
      // Update other HTML elements as needed
      
  
  
        $.ajax({
            url: "rest/wanted",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#wanted-a").html("");
              var html = "";
              var wanted = 0;
              
              for (let i = 0; i<data.length; i++) {
                wanted++;
              }
  
                  html += `
                      <div class="h5 mb-0 font-weight-bold text-gray-800" style="font-size: 25px;">`+wanted+`</div>
                      `;
                  
                  $("#wanted-a").html(html);
            },
            error: function () {
              AdminService.logout();
            }
          });
  
          $.ajax({
            url: "rest/locked/reports",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#report-a").html("");
              var html = "";
              var reports = 0;
              
              for (let i = 0; i<data.length; i++) {
                reports++;
              }
  
                  html += `
                      <div class="h5 mb-0 font-weight-bold text-gray-800" style="font-size: 25px;">`+reports+`</div>
                      `;
                  
                  $("#report-a").html(html);
            },
            error: function () {
              AdminService.logout();
            }
          });
  
          $.ajax({
            url: "rest/news",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#news-a").html("");
              var html = "";
              var news = 0;
              
              for (let i = 0; i<data.length; i++) {
                news++;
              }
  
                  html += `
                      <div class="h5 mb-0 font-weight-bold text-gray-800" style="font-size: 25px;">`+news+`</div>
                      `;
                  
                  $("#news-a").html(html);
            },
            error: function () {
              AdminService.logout();
            }
          });
  
          $.ajax({
            url: "rest/locked/newsletter",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#newsletter-a").html("");
              var html = "";
              var newsletter = 0;
              
              for (let i = 0; i<data.length; i++) {
                newsletter++;
              }
  
                  html += `
                      <div class="h5 mb-0 font-weight-bold text-gray-800" style="font-size: 25px;">`+newsletter+`</div>
                      `;
                  
                  $("#newsletter-a").html(html);
            },
            error: function () {
              AdminService.logout();
            }
          });
  
          $.ajax({
            url: "rest/missing",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#missing-a").html("");
              var html = "";
              var missing = 0;
              
              for (let i = 0; i<data.length; i++) {
                missing++;
              }
  
                  html += `
                      <div class="h5 mb-0 font-weight-bold text-gray-800" style="font-size: 25px;">`+missing+`</div>
                      `;
                  
                  $("#missing-a").html(html);
            },
            error: function () {
              AdminService.logout();
            }
          });
          
  
          $.ajax({
            url: "rest/news",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#breaking-news").html("");
              var html = "";
              var a = "";
              if (data.length > 5) {
                  a = data.length - 5;
              } else {
                  a = 0;
              }
              
              for (let i = data.length - 1; i>=a; i--) {
                  if (i == data.length -1) {
                      html += `
                      <div class="carousel-item active">
                          <img class="w-100" src="`+data[i].image+`" alt="Image">
                          <div class="carousel-caption">
                              <div class="container">
                                  <div class="row justify-content- bottom-50">
                                      <div class="col-lg-12 text-start">
                                          <h1 class="display-4 text-white mb-4 animated slideInRight"><strong>`+data[i].title+`</strong></h1>
                                          <a href="news.html" class="btn btn-dark rounded-pill py-3 px-5 animated slideInRight">See More</a>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                      `;
                  } else {
                      html += `
                      <div class="carousel-item">
                          <img class="w-100" src="`+data[i].image+`" alt="Image">
                          <div class="carousel-caption">
                              <div class="container">
                                  <div class="row justify-content- bottom-50">
                                      <div class="col-lg-12 text-start">
                                          <h1 class="display-4 text-white mb-4 animated slideInRight"><strong>`+data[i].title+`</strong></h1>
                                          <a href="news.html" class="btn btn-dark rounded-pill py-3 px-5 animated slideInRight">See More</a>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                      `;
                  }
                  
                  $("#breaking-news").html(html);
              }
            },
            error: function () {
              AdminService.logout();
            }
          });
          
          $.ajax({
            url: "rest/locked/reports",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#reports-progress").html("");
              var html = "";
              var ter = 0;
              var cyc = 0;
              var pcor = 0;
              var civr = 0;
              var orgc = 0;
              var drut = 0;
              var mp = 0;
              var wp = 0;
              var oth = 0;
              
              var n = 0;
              var in_process = 0;
              var done = 0;
              var canc = 0;
              
              for (let i = 0; i<data.length; i++) {
                  if(data[i].category == "terrorism") {
                      ter+= 1;
                  } else if(data[i].category == "cyber-crime") {
                      cyc+= 1;
                  } else if(data[i].category == "public-corruption") {
                      pcor+= 1;
                  } else if(data[i].category == "civil-rights") {
                      civr+= 1;
                  } else if(data[i].category == "organized-crime") {
                      orgc+= 1;
                  } else if(data[i].category == "drug-trafficking") {
                      drut+= 1;
                  } else if(data[i].category == "missing-person") {
                      mp+= 1;
                  } else if(data[i].category == "wanted-person") {
                      wp+= 1;
                  } else if(data[i].category == "other") {
                      oth+= 1;
                  }
              };
  
              for (let i = 0; i<data.length; i++) {
                  if(data[i].status == "none" || data[i].status == null) {
                      n+= 1;
                  } else if(data[i].status == "in-process") {
                      in_process+= 1;
                  } else if(data[i].status == "finished") {
                      done+= 1;
                  } else if(data[i].status == "canceled") {
                      canc+= 1;
                  }
              };
  
              var tp = ((ter/data.length)*100).toFixed(2);
              var ccp = ((cyc/data.length)*100).toFixed(2);
              var pcp = ((pcor/data.length)*100).toFixed(2);
              var crp = ((civr/data.length)*100).toFixed(2);
              var ocp = ((orgc/data.length)*100).toFixed(2);
              var dtp = ((drut/data.length)*100).toFixed(2);
              var mtp = ((mp/data.length)*100).toFixed(2);
              var wtp = ((wp/data.length)*100).toFixed(2);
              var othtp = ((oth/data.length)*100).toFixed(2);
  
              var n_p = ((n/data.length)*100).toFixed(2);
              var in_process_p = ((in_process/data.length)*100).toFixed(2);
              var done_p = ((done/data.length)*100).toFixed(2);
              var canc_p = ((canc/data.length)*100).toFixed(2);

              let ctx = document.getElementById("myChart").getContext("2d");
              let myChart = new Chart(ctx, {
                type: "pie",
                data: {
                  labels: [
                    "Terrorism",
                    "Cyber Crime",
                    "Public Corruption",
                    "Civil Rights",
                    "Organized Crime",
                    "Drug Trafficking",
                    "Missing Person",
                    "Wanted Person",
                    "Other",
                  ],
                  datasets: [{
                  data: [tp, ccp, pcp, crp, ocp, dtp, mtp, wtp, othtp],
                  backgroundColor: [
                    "#0275d8",
                    "#5cb85c",
                    "#5bc0de",
                    "#f0ad4e",
                    "#d9534f",
                    "#292b2c",
                    "#f7f7f7",
                    "#a37554",
                    "#2c2c4d",
                  ],
                  borderColor: "transparent"
                }],
                },
              });
  
                  html += `
                  <div class="progress mb-3" style="height: 30px;">
                          <div class="progress-bar bg-dark" role="progressbar" style="width: `+n_p+`%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">`+n_p+`%</div>
                          <div class="progress-bar bg-warning" role="progressbar" style="width: `+in_process_p+`%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">`+in_process_p+`%</div>
                          <div class="progress-bar bg-success" role="progressbar" style="width: `+done_p+`%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">`+done_p+`%</div>
                          <div class="progress-bar bg-danger" role="progressbar" style="width: `+canc_p+`%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">`+canc_p+`%</div>
  
                      </div>
                      <div class="row g-4 pt-2 mb-5">
                          <div class="col-sm-3">
                              <span class="text-dark" style="font-size: 1.1rem;"><strong>No Action</strong></span><br>
                          </div>                            
                          <div class="col-sm-3">
                              <span class="text-warning" style="font-size: 1.1rem;"><strong>In Process</strong></span><br>  
                          </div>
                          <div class="col-sm-3">
                              <span class="text-success" style="font-size: 1.1rem;"><strong>Finished</strong></span><br>
                          </div>
                          <div class="col-sm-3">
                              <span class="text-danger" style="font-size: 1.1rem;"><strong>Canceled</strong></span><br>
                          </div>
                      </div>
                  `;
                  $("#reports-progress").html(html);
  
            },
            error: function () {
              AdminService.logout();
            }
          });
          
          $.ajax({
            url: "rest/wanted",
            type: "GET",
            beforeSend: function (xhr) {
              xhr.setRequestHeader("Authorization", localStorage.getItem("token"));
            },
            success: function(data) {
              $("#recently-wanted").html("");
              var html = "";
              var a = "";
              if (data.length > 2) {
                  a = data.length - 2;
              } else {
                  a = 0;
              }
              
              for (let i = data.length - 1; i>=a; i--) {
                      html += `
                      <div class="col-lg-6 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                          <div class="team-item rounded bg-danger overflow-hidden pb-4">
                              <img class="img-fluid mb-4" style="float: left; width: 100%; height: 450px; object-fit: cover;" src="`+data[i].image+`" alt="">
                              <h5 class="text-white">`+data[i].first_name + " " + data[i].last_name+`</h5>
                              <span class="text-light">`+data[i].description+`</span>
                          </div>
                      </div>
                      `;
                  
                  
                  $("#recently-wanted").html(html);
              }
  
            },
            error: function () {
              AdminService.logout();
            }
          });
  
      </script>
  
      
  </body>
  
  <script>
      



    var token = localStorage.getItem("token");
      if (token){
          NewsService.init();
          NewsletterService.init();
          WantedService.init();
          ReportsService.init();
          MissingService.init();
      }else{
          window.location.replace("login.html");
      }
  </script>